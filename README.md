# UrlShorter
RESTful API для сокращателя ссылок. Сокращатель ссылок - 
сервис, который позволяет пользователю создавать более 
короткие адреса, которые лучше передавать другим 
пользователям и собирает статистику по совершенным 
переходам. Примеры таких сервисов: https://goo.gl/, 
https://bitly.com/.  
Для авторизации используется **HTTP Basic Authorization**.
## Приступая к работе
Необходимо установить:
* Java 17;
* Apache Maven 3.6.3;
* PostgreSQL.

Cоздать БД: **urlShorter**.

В файле **application.properties** (resources) задать переменные окружения:
* Строка подключения к базе данных (`spring.datasource.url`);
* Имя пользователя Postgres (`spring.datasource.username`);
* Пароль пользователя Postgres (`spring.datasource.password`);
* Используемый домен (`domain`, по умолч. http://localhost:8080/).

## Запуск
Запустить командой в корневой директории проекта

`./mvnw clean install spring-boot:run` или `./mvnw spring-boot:run`

## Схема БД
Для управления базой данных использовалась библиотека Liquibase
(изменения описаны в формате xml). В результате автоматически создаются 3 таблицы:
* **Users** - для хранения данных пользователя;
* **Url** - для хранения url;
* **Transition** - для хранения информации о переходах по ссылкам.

(+2 таблицы для работы liquibase - **databasechangelog**, **databasechangeloglock**)

Также создается генератор последовательности **url_sequence**, который необходим для 
генерации короткого url.

## Методы API
Спецификация API представлена в формате **Swagger**: http://localhost:8080/swagger-ui-custom.html (доступна после
запуска приложения).

API для UserController протестированы с помощью **интеграционных тестов**.

### Некоторые уточнения
* Авторизация требуется для всех операций кроме регистриации пользователя и редиректа по короткой ссылке;
* Удаление короткой ссылки производится путем проставления даты удаления, тем самым 
позволяя учитывать все ссылки в статистике;
* Статистика применяется только к тем ссылкам, которые принадлежат
текущему пользователю;
* При получении временного графика количества переходов с группировкой 
по дням, часам, минутам необходимо указать 2 даты (в формате yyyy-MM-dd'T'HH:mm:ss), в диапазоне которых 
требуется посчитать число переходов. Будут учитаны только те ссылки, которые созданы после даты, указанной как 
начало дипазона.
